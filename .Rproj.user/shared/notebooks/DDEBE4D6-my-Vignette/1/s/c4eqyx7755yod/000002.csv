"0","portion_ROC <- function(up.limit, low.limit, fpr.roc,sen.roc){"
"0",""
"0","  i.low<-min(which(fpr.roc >= low.limit))"
"0","  j.low<-max(i.low-1, 1)"
"0","  i.up<-max(which(fpr.roc <= up.limit))"
"0","  j.up<-min(1+i.up, length(fpr.roc))"
"0","  fpr.proc<-fpr.roc[i.low:i.up]"
"0","  sen.proc<-sen.roc[i.low:i.up]"
"0","  if (fpr.roc[i.low] > low.limit) {"
"0","    fpr.proc<-append(fpr.proc, low.limit, 0)"
"0","    sen.proc<-append(sen.proc, sen.roc[j.low]+(sen.roc[i.low]-sen.roc[j.low])*(fpr.proc[1]-fpr.roc[j.low])/(fpr.roc[i.low]-fpr.roc[j.low]), 0)}"
"0","  if (fpr.roc[i.up] < up.limit) {"
"0","    fpr.proc<-append(fpr.proc, up.limit, length(fpr.proc))"
"0","    sen.proc<-append(sen.proc, sen.roc[j.up]-(sen.roc[j.up]-sen.roc[i.up])*(fpr.roc[j.up]-fpr.proc[length(fpr.proc)])/(fpr.roc[j.up]-fpr.roc[i.up]), length(sen.proc))}"
"0",""
"0","  return(cbind(fpr.proc, sen.proc))"
"0","}"
"0",""
"0","classification_Tp <- function(fpr.proc,sen.proc){"
"0",""
"0","  if (all(sen.proc>=fpr.proc)) {"
"0","    proper.proc<-TRUE} else {proper.proc<-FALSE}"
"0","  plr.proc<-(sen.proc-sen.proc[1])/(fpr.proc-fpr.proc[1])"
"0","  plr.proc<-plr.proc[is.finite(plr.proc)]"
"0","  if (all(plr.proc>=plr.proc[length(plr.proc)])) {"
"0","    plr.proc.bounded<-TRUE} else {plr.proc.bounded<-FALSE}"
"0",""
"0","  classification <- c(plr.proc.bounded,proper.proc)"
"0",""
"0","  return(classification)"
"0","}"
"0",""
"0","#Tighter partial area under a portion"
"0","TpA <- function(fpr.proc, sen.proc){"
"0","  pA.roc <- pA(fpr.proc, sen.proc)"
"0","  type_roc <- classification_Tp(fpr.proc, sen.proc)"
"0",""
"0","  min.pAUC<-sum(diff(fpr.proc^2))/2"
"0","  max.pAUC<-sum(diff(fpr.proc))"
"0","  TpAUC.max.roc<-max.pAUC*max(sen.proc)"
"0",""
"0","  if (min(sen.proc) == max(sen.proc) ) {"
"0","    TpAUC.min.roc =0} else {"
"0","      if (type_roc[1]) {"
"0","        TpAUC.min.roc<-sum(diff(fpr.proc))*mean(c(min(sen.proc), max(sen.proc)))"
"0","        } else {"
"0",""
"0","        if (type_roc[2]) {"
"0","            TpAUC.min.roc<-max(max.pAUC*min(sen.proc), min.pAUC)"
"0","          } else {TpAUC.min.roc<-max.pAUC*min(sen.proc)}"
"0","        }"
"0","      }"
"0","  if (min(fpr.proc) == max(fpr.proc) ) { TpAUC.max.roc = 1}"
"0",""
"0","  if (max(sen.proc)!=0 )"
"0","  {TpA.roc<-(1+((pA.roc-TpAUC.min.roc)/(TpAUC.max.roc-TpAUC.min.roc)))/2} else {TpA.roc=0}"
"0",""
"0","  return(TpA.roc)"
"0",""
"0","}"
"0","#Calculate the partial area under a portion"
"0","pA <- function(fpr.proc,sen.proc){"
"0","  aux <- sum(diff(fpr.proc)*"
"0","              apply(cbind(sen.proc[-1],"
"0","                          sen.proc[-length(sen.proc)]), 1, mean))"
"0","  return(aux)"
"0","}"
"0",""
"0","#McClish partial area under a portion"
"0","MCpA <- function(sen.proc,fpr.proc){"
"0","  pA.roc <- pA(fpr.proc, sen.proc)"
"0","  type_roc <- classification_Tp(fpr.proc, sen.proc)"
"0",""
"0","  max.pAUC <- sum(diff(fpr.proc))"
"0","  min.pAUC <- sum(diff(fpr.proc^2))/2"
"0",""
"0","  if (type_roc[2]) {"
"0","    if (min(fpr.proc) == max(fpr.proc) ) { max.pAUC = 1}"
"0",""
"0","            MCpA.roc<-(1+((pA.roc-min.pAUC)/(max.pAUC-min.pAUC)))/2"
"0","    } else {"
"0","      MCpA.roc<-NA}"
"0",""
"0","  return(MCpA.roc)"
"0","}"
"0",""
"0","fbootT<- function(dataset,bssample, low.limit, up.limit){"
"0","  SpAUC <- NULL"
"0","  bsdata <- dataset[bssample,]"
"0","  for (i in 2:dim(bsdata)[2]) {"
"0","    bsdata_temp <- cbind(bsdata[,1],bsdata[,i])"
"0","    sen.roc<- points_curve(bsdata_temp[,1],bsdata_temp[,2])[,2]"
"0","    fpr.roc<- points_curve(bsdata_temp[,1],bsdata_temp[,2])[,1]"
"0",""
"0","    fpr.proc <- portion_ROC(up.limit, low.limit, fpr.roc,sen.roc)[,1]"
"0",""
"0","    sen.proc <- portion_ROC(up.limit, low.limit, fpr.roc,sen.roc)[,2]"
"0","    SpAUC[i-1] <- TpA(fpr.proc,sen.proc)"
"0","    "
"0","  }"
"0","  return(SpAUC)"
"0","}"
"0",""
"0","fbootM<- function(dataset,bssample, low.limit, up.limit){"
"0","  SpAUC <- NULL"
"0","  bsdata <- dataset[bssample,]"
"0","  for (i in 2:dim(bsdata)[2]) {"
"0","    bsdata_temp <- cbind(bsdata[,1],bsdata[,i])"
"0","    sen.roc<- points_curve(bsdata_temp[,1],bsdata_temp[,2])[,2]"
"0","    fpr.roc<- points_curve(bsdata_temp[,1],bsdata_temp[,2])[,1]"
"0",""
"0","    fpr.proc <- portion_ROC(up.limit, low.limit, fpr.roc,sen.roc)[,1]"
"0",""
"0","    sen.proc <- portion_ROC(up.limit, low.limit, fpr.roc,sen.roc)[,2]"
"0","    SpAUC[i-1] <- MCpA(sen.proc,fpr.proc)"
"0",""
"0",""
"0","  }"
"0","  return(SpAUC)"
"0","}"
"0",""
"0","createSE <- function(object, names){"
"0","  names(object) <- names"
"0","  names <- names"
"0",""
"0","  data.matrix <- as.matrix(object)"
"0","  "
"0","  se=SummarizedExperiment::SummarizedExperiment(assays=data.matrix,"
"0","                          colData<-data.frame(metrics = (names)))"
"0","  names(se@assays$data@listData[[1]]) <- names"
"0","  return(se)"
"0","}"
